
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–µå–µå•è¯ç‹ V6.0 - æ·±åº¦æŒ‘æˆ˜ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@900&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background: #FFF9E6; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        .card-item {
            font-size: 2.2rem; font-weight: 900; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-bottom: 8px solid #E2E8F0; display: flex; align-items: center; justify-content: center;
            min-height: 120px; background: white; border-radius: 2rem; box-shadow: 0 8px 0 #CBD5E1;
        }

        /* é€‰ä¸­æ€ */
        .card-selected { transform: translateY(-4px); background-color: #3B82F6 !important; color: white !important; border-bottom-width: 4px; box-shadow: 0 4px 0 #1D4ED8; }

        /* é”™è¯¯æŠ–åŠ¨åŠ¨ç”» */
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; border-color: #EF4444 !important; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        .matched-hide { animation: matchOut 0.5s forwards; pointer-events: none; }
        @keyframes matchOut { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }

        .floating { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-hidden">

    <div id="homeUI" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center p-8 text-center">
        <div class="text-[100px] mb-6 floating">ğŸ“ğŸ±</div>
        <h1 class="text-6xl font-black text-slate-800 mb-4">å–µå–µå•è¯ç‹</h1>
        <div class="bg-orange-100 text-orange-600 px-6 py-2 rounded-full font-bold mb-10 text-xl">æŒ‘æˆ˜æ¨¡å¼ï¼šé”™è¯¯ä¼šæ‰£åˆ†å“¦ï¼</div>
        <button id="startBtn" class="w-full max-w-lg bg-blue-600 text-white text-4xl font-black py-10 rounded-[3rem] shadow-2xl active:scale-95 transition-all">
            å¼€å§‹æŒ‘æˆ˜ ğŸš€
        </button>
        <p class="mt-8 text-slate-400 font-bold">æœ€é«˜åˆ†å†å²è®°å½•: <span id="bestScore">0</span></p>
    </div>

    <header class="p-6 flex justify-between items-center bg-white shadow-sm">
        <div class="flex items-center gap-4">
            <button onclick="location.reload()" class="w-14 h-14 bg-slate-100 rounded-full flex items-center justify-center text-2xl">ğŸ </button>
            <div>
                <div id="levelTitle" class="text-2xl font-black text-slate-700">å…³å¡</div>
                <div id="lifeContainer" class="flex gap-1 text-xl">â¤ï¸â¤ï¸â¤ï¸</div>
            </div>
        </div>
        <div class="text-right">
            <div id="score" class="text-5xl font-black text-blue-600">0</div>
            <div id="comboText" class="text-orange-500 font-black italic h-6 opacity-0 transition-opacity">COMBO x2</div>
        </div>
    </header>

    <main class="flex-grow p-6 max-w-5xl mx-auto w-full">
        <div class="w-full h-4 bg-slate-200 rounded-full mb-8 overflow-hidden">
            <div id="progressBar" class="h-full bg-green-500 transition-all duration-500" style="width: 0%"></div>
        </div>
        <div class="grid grid-cols-2 gap-6" id="board">
            <div id="leftCol" class="space-y-6"></div>
            <div id="rightCol" class="space-y-6"></div>
        </div>
    </main>

    <div id="winModal" class="hidden fixed inset-0 z-[110] bg-slate-900/90 backdrop-blur-md flex items-center justify-center p-6 text-center">
        <div class="bg-white w-full max-w-xl rounded-[4rem] p-12 shadow-2xl">
            <div id="resultEmoji" class="text-9xl mb-6">ğŸ†</div>
            <h2 id="resultTitle" class="text-5xl font-black mb-4">å…³å¡å®Œæˆï¼</h2>
            <div id="starDisplay" class="text-5xl mb-8 flex justify-center gap-2">â­â­â­</div>
            <p id="resultMsg" class="text-slate-500 text-xl mb-12"></p>
            <button id="nextBtn" class="w-full bg-orange-500 text-white font-black py-8 rounded-3xl text-3xl shadow-lg active:scale-95">ç»§ç»­æŒ‘æˆ˜ ğŸ¾</button>
        </div>
    </div>

    <script>
        let audioCtx = null, score = 0, bestScore = localStorage.getItem('catBest') || 0, 
            curLv = 0, matched = 0, combo = 0, lives = 3, selL = null, selR = null;

        document.getElementById('bestScore').innerText = bestScore;

        const LIB = [
            { title: "ğŸ æ°´æœå¤§æœç´¢", words: [{id:1,en:'Apple',cn:'è‹¹æœ',icon:'ğŸ'}, {id:2,en:'Banana',cn:'é¦™è•‰',icon:'ğŸŒ'}, {id:3,en:'Grape',cn:'è‘¡è„',icon:'ğŸ‡'}, {id:4,en:'Peach',cn:'æ¡ƒå­',icon:'ğŸ‘'}] },
            { title: "ğŸ¦ ä¸›æ—æ¢é™©", words: [{id:5,en:'Lion',cn:'ç‹®å­',icon:'ğŸ¦'}, {id:6,en:'Panda',cn:'ç†ŠçŒ«',icon:'ğŸ¼'}, {id:7,en:'Rabbit',cn:'å…”å­',icon:'ğŸ°'}, {id:8,en:'Tiger',cn:'è€è™',icon:'ğŸ¯'}] },
            { title: "ğŸ• å¨æˆ¿æ´¾å¯¹", words: [{id:9,en:'Bread',cn:'é¢åŒ…',icon:'ğŸ'}, {id:10,en:'Milk',cn:'ç‰›å¥¶',icon:'ğŸ¥›'}, {id:11,en:'Pizza',cn:'æ¯”è¨',icon:'ğŸ•'}, {id:12,en:'Juice',cn:'æœæ±',icon:'ğŸ§ƒ'}] },
            { title: "ğŸ¨ è‰²å½©é­”æ–¹", words: [{id:13,en:'Red',cn:'çº¢è‰²',icon:'ğŸ”´'}, {id:14,en:'Blue',cn:'è“è‰²',icon:'ğŸ”µ'}, {id:15,en:'Green',cn:'ç»¿è‰²',icon:'ğŸŸ¢'}, {id:16,en:'Pink',cn:'ç²‰è‰²',icon:'ğŸ’—'}] }
        ];

        function initAudio() { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

        function speak(text) {
            new Audio(`https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(text)}&type=2`).play();
        }

        function playSound(freq, type="sine", dur=0.3) {
            if(!audioCtx) return;
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            o.type = type; o.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            o.start(); o.stop(audioCtx.currentTime + dur);
        }

        document.getElementById('startBtn').onclick = () => { initAudio(); initGame(0); };

        function initGame(idx) {
            curLv = idx; matched = 0; combo = 0; lives = 3; selL = null; selR = null;
            document.getElementById('homeUI').classList.add('hidden');
            document.getElementById('winModal').classList.add('hidden');
            document.getElementById('score').innerText = score;
            document.getElementById('levelTitle').innerText = LIB[curLv].title;
            updateLives();
            render();
        }

        function updateLives() {
            document.getElementById('lifeContainer').innerText = "â¤ï¸".repeat(lives) + "ğŸ¤".repeat(3-lives);
        }

        function render() {
            const lCol = document.getElementById('leftCol'), rCol = document.getElementById('rightCol');
            lCol.innerHTML = ''; rCol.innerHTML = '';
            const words = LIB[curLv].words;
            [...words].sort(() => Math.random()-0.5).forEach(i => lCol.appendChild(createBtn(i.en, 'L', i.id, i.en)));
            [...words].sort(() => Math.random()-0.5).forEach(i => rCol.appendChild(createBtn(i.icon+' '+i.cn, 'R', i.id, i.en)));
        }

        function createBtn(txt, side, id, english) {
            const b = document.createElement('button');
            b.className = "card-item w-full";
            b.innerText = txt;
            b.onclick = () => {
                if(b.classList.contains('matched-hide')) return;
                speak(english);
                if(side === 'L') { if(selL) selL.classList.remove('card-selected'); selL = b; }
                else { if(selR) selR.classList.remove('card-selected'); selR = b; }
                b.classList.add('card-selected');

                if (selL && selR) {
                    if (selL.dataset.id === selR.dataset.id) {
                        // åŒ¹é…æˆåŠŸ
                        combo++;
                        const bonus = combo > 1 ? combo * 20 : 0;
                        score += (100 + bonus);
                        matched++;
                        document.getElementById('score').innerText = score;
                        document.getElementById('progressBar').style.width = (matched/LIB[curLv].words.length*100)+'%';
                        
                        if(combo > 1) {
                            const cbt = document.getElementById('comboText');
                            cbt.innerText = `COMBO x${combo}!`;
                            cbt.style.opacity = 1;
                        }
                        
                        playSound(880, "sine");
                        confetti({ particleCount: 40, spread: 60, origin: { y: 0.8 } });
                        selL.classList.add('matched-hide'); selR.classList.add('matched-hide');
                        selL = null; selR = null;
                        if (matched === LIB[curLv].words.length) setTimeout(showResult, 800);
                    } else {
                        // åŒ¹é…é”™è¯¯
                        combo = 0;
                        score = Math.max(0, score - 20); // æ‰£åˆ†
                        lives = Math.max(0, lives - 1);
                        document.getElementById('score').innerText = score;
                        document.getElementById('comboText').style.opacity = 0;
                        updateLives();
                        
                        const l = selL, r = selR;
                        l.classList.add('shake'); r.classList.add('shake');
                        playSound(220, "sawtooth");
                        setTimeout(() => { 
                            l.classList.remove('card-selected', 'shake'); 
                            r.classList.remove('card-selected', 'shake'); 
                        }, 500);
                        selL = null; selR = null;
                        if(lives === 0) setTimeout(() => showResult(true), 500);
                    }
                }
            };
            b.dataset.id = id;
            return b;
        }

        function showResult(isGameOver = false) {
            const modal = document.getElementById('winModal');
            modal.classList.remove('hidden');
            
            if(isGameOver) {
                document.getElementById('resultEmoji').innerText = "ğŸ˜¿";
                document.getElementById('resultTitle').innerText = "å¤±è´¥äº†...";
                document.getElementById('starDisplay').innerText = "åŠ æ²¹ï¼Œä½ å¯ä»¥çš„ï¼";
                document.getElementById('resultMsg').innerText = "åˆ«ç°å¿ƒï¼ŒçŒ«å’ªè€å¸ˆé™ªä½ å†ç»ƒä¸€æ¬¡ï¼";
                document.getElementById('nextBtn').innerText = "é‡æ–°æŒ‘æˆ˜ ğŸ”„";
                document.getElementById('nextBtn').onclick = () => { score = 0; initGame(curLv); };
            } else {
                document.getElementById('resultEmoji').innerText = "ğŸ†";
                document.getElementById('resultTitle').innerText = "é€šå…³æˆåŠŸï¼";
                document.getElementById('starDisplay').innerText = lives === 3 ? "â­â­â­" : (lives === 2 ? "â­â­" : "â­");
                document.getElementById('resultMsg').innerText = `æœ¬å…³å¾—åˆ†: ${score}`;
                document.getElementById('nextBtn').innerText = "æŒ‘æˆ˜ä¸‹ä¸€å…³ ğŸ¾";
                
                if(score > bestScore) {
                    bestScore = score;
                    localStorage.setItem('catBest', bestScore);
                    document.getElementById('resultMsg').innerText += " (æ–°çºªå½•! ğŸŠ)";
                }

                document.getElementById('nextBtn').onclick = () => {
                    if (curLv < LIB.length - 1) initGame(curLv + 1);
                    else { alert("ğŸ‰ ä½ å·²ç»é€šå…³äº†æ‰€æœ‰å…³å¡ï¼"); location.reload(); }
                };
            }
        }
    </script>
</body>
</html>
