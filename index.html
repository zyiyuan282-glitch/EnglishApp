
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–µå–µå•è¯ç‹ - åä¸ºå¹³æ¿ä¸“ç”¨ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@700;900&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background: #f0f9ff; user-select: none; -webkit-tap-highlight-color: transparent; }
        /* é’ˆå¯¹å¤§å±å¹³æ¿ä¼˜åŒ–å­—å· */
        .card-item { font-size: 2rem; font-weight: 900; transition: all 0.2s; border-bottom: 8px solid #e2e8f0; display: flex; align-items: center; justify-content: center; min-height: 120px; background: white; border-radius: 2.5rem; cursor: pointer; padding: 15px; text-align: center; }
        .card-selected { transform: translateY(-10px); background-color: #3b82f6 !important; color: white !important; border-bottom-color: #1d4ed8; box-shadow: 0 20px 30px -5px rgba(59, 130, 246, 0.4); }
        .matched-hide { animation: matchOut 0.5s forwards; pointer-events: none; }
        @keyframes matchOut { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="homeUI" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center p-8 text-center">
        <div class="text-[180px] mb-8">ğŸ±</div>
        <h1 class="text-6xl font-black text-slate-800 mb-4">å–µå–µå•è¯ç‹</h1>
        <p class="text-blue-500 font-bold mb-16 text-2xl">åä¸ºå¹³æ¿ç”¨æˆ·ï¼šè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å¯éŸ³æ•ˆ</p>
        <button id="mainStartBtn" class="w-full max-w-md bg-blue-600 text-white text-4xl font-black py-10 rounded-[4rem] shadow-2xl active:scale-95 transition-all">
            å¼€å¯æœ‰å£°ä¹‹æ—… ğŸš€
        </button>
    </div>

    <header class="p-8 flex justify-between items-center bg-white shadow-sm sticky top-0 z-10">
        <button onclick="location.reload()" class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center text-4xl">ğŸ </button>
        <div id="levelTitle" class="text-3xl font-black text-slate-700">åŠ è½½ä¸­...</div>
        <div class="bg-blue-50 px-8 py-3 rounded-full"><span id="score" class="text-4xl font-black text-blue-600">0</span></div>
    </header>

    <main class="flex-grow p-8 max-w-6xl mx-auto w-full">
        <div class="w-full h-6 bg-slate-200 rounded-full mb-12 overflow-hidden">
            <div id="progressBar" class="h-full bg-blue-500 transition-all duration-500" style="width: 0%"></div>
        </div>
        <div class="grid grid-cols-2 gap-8" id="board">
            <div id="leftCol" class="space-y-8"></div>
            <div id="rightCol" class="space-y-8"></div>
        </div>
    </main>

    <div id="winModal" class="hidden fixed inset-0 z-[110] bg-slate-900/70 backdrop-blur-md flex items-center justify-center p-6 text-center">
        <div class="bg-white w-full max-w-2xl rounded-[5rem] p-20 shadow-2xl">
            <div class="text-[120px] mb-8">ğŸ†</div>
            <h2 class="text-5xl font-black mb-16 text-slate-800">é€šå…³æˆåŠŸï¼</h2>
            <button id="nextBtn" class="w-full bg-blue-600 text-white font-black py-8 rounded-3xl text-3xl shadow-lg">ä¸‹ä¸€å…³ ğŸš€</button>
        </div>
    </div>

    <script>
        // --- åä¸ºå¹³æ¿å¼ºå…¼å®¹å‘éŸ³å¼•æ“ ---
        let audioCtx = null;
        const synth = window.speechSynthesis;

        // åˆå§‹åŒ–éŸ³é¢‘ï¼ˆç”±ç”¨æˆ·æ‰‹åŠ¨è§¦å‘ï¼‰
        function initAudioEngine() {
            try {
                // 1. å°è¯•åˆå§‹åŒ– Web Audio
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
                
                // 2. é¢„çƒ­ Speech Synthesis
                // åœ¨å®‰å“ä¸Šï¼Œå¿…é¡»å…ˆ speak ä¸€ä¸ªç©ºå­—ç¬¦ä¸²æ¥æŠ¢å éŸ³é¢‘ç„¦ç‚¹
                const warmUp = new SpeechSynthesisUtterance('');
                synth.speak(warmUp);
                
                console.log("éŸ³é¢‘ç³»ç»Ÿå°±ç»ª");
            } catch (e) {
                console.error("éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥", e);
            }
        }

        // æ’­æ”¾å®çš„ä¸€å£°ï¼ˆåˆæˆéŸ³è‰²ï¼Œé¿å¼€åä¸ºç³»ç»Ÿå¯¹ MP3 çš„æ‹¦æˆªï¼‰
        function playEffect() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(1000, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        // æœ—è¯»å•è¯
        function speak(text) {
            synth.cancel(); // å¿…é¡»å…ˆå–æ¶ˆï¼Œå¦åˆ™åä¸ºç³»ç»Ÿå¯èƒ½ä¼šå¡åœ¨é˜Ÿåˆ—é‡Œ
            const msg = new SpeechSynthesisUtterance(text.replace(/[^\x00-\xff]/g, ""));
            msg.lang = 'en-US';
            msg.rate = 0.8;
            msg.volume = 1.0;
            synth.speak(msg);
        }

        const LIB = [
            { title: "ç¬¬ä¸€å…³ï¼šæ°´æœ", words: [{ id: 1, en: 'Apple', cn: 'è‹¹æœ', icon: 'ğŸ' },{ id: 2, en: 'Banana', cn: 'é¦™è•‰', icon: 'ğŸŒ' },{ id: 3, en: 'Grape', cn: 'è‘¡è„', icon: 'ğŸ‡' },{ id: 4, en: 'Peach', cn: 'æ¡ƒå­', icon: 'ğŸ‘' }]},
            { title: "ç¬¬äºŒå…³ï¼šåŠ¨ç‰©", words: [{ id: 5, en: 'Lion', cn: 'ç‹®å­', icon: 'ğŸ¦' },{ id: 6, en: 'Panda', cn: 'ç†ŠçŒ«', icon: 'ğŸ¼' },{ id: 7, en: 'Rabbit', cn: 'å…”å­', icon: 'ğŸ°' },{ id: 8, en: 'Tiger', cn: 'è€è™', icon: 'ğŸ¯' }]}
        ];

        let curLv = 0, selL = null, selR = null, matched = 0, score = 0;

        document.getElementById('mainStartBtn').onclick = () => {
            initAudioEngine(); // æ ¸å¿ƒï¼šç”¨æˆ·ç¬¬ä¸€æ¬¡äº¤äº’
            initGame(0);
        };

        function initGame(idx) {
            curLv = idx; matched = 0; selL = null; selR = null;
            document.getElementById('homeUI').classList.add('hidden');
            document.getElementById('winModal').classList.add('hidden');
            document.getElementById('levelTitle').innerText = LIB[curLv].title;
            render();
        }

        function render() {
            const lCol = document.getElementById('leftCol'), rCol = document.getElementById('rightCol');
            lCol.innerHTML = ''; rCol.innerHTML = '';
            const words = LIB[curLv].words;
            const dL = [...words].sort(() => Math.random() - 0.5);
            const dR = [...words].sort(() => Math.random() - 0.5);
            dL.forEach(i => lCol.appendChild(createBtn(i.en, 'L', i.id, i.en)));
            dR.forEach(i => rCol.appendChild(createBtn(i.icon + ' ' + i.cn, 'R', i.id, i.en)));
        }

        function createBtn(txt, side, id, english) {
            const b = document.createElement('button');
            b.className = "card-item w-full shadow-md";
            b.innerText = txt;
            b.onclick = () => {
                speak(english); // æœ—è¯»
                if (side === 'L') { if(selL) selL.classList.remove('card-selected'); selL = b; }
                else { if(selR) selR.classList.remove('card-selected'); selR = b; }
                b.classList.add('card-selected');
                if (selL && selR) {
                    if (selL.dataset.id === selR.dataset.id) {
                        score += 100; matched++;
                        document.getElementById('score').innerText = score;
                        document.getElementById('progressBar').style.width = (matched / LIB[curLv].words.length * 100) + '%';
                        playEffect(); // æ’­æ”¾åˆæˆéŸ³æ•ˆ
                        confetti({ particleCount: 60, spread: 80, origin: { y: 0.8 } });
                        const l = selL, r = selR;
                        l.classList.add('matched-hide'); r.classList.add('matched-hide');
                        selL = null; selR = null;
                        if (matched === LIB[curLv].words.length) setTimeout(showVictory, 800);
                    } else {
                        const l = selL, r = selR;
                        setTimeout(() => { l.classList.remove('card-selected'); r.classList.remove('card-selected'); }, 400);
                        selL = null; selR = null;
                    }
                }
            };
            b.dataset.id = id;
            return b;
        }

        function showVictory() {
            document.getElementById('winModal').classList.remove('hidden');
            document.getElementById('nextBtn').onclick = () => {
                if (curLv < LIB.length - 1) initGame(curLv + 1);
                else location.reload();
            };
        }
    </script>
</body>
</html>
