
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–µå–µå•è¯ç‹ V7.0 - å…¨å±æŒ‘æˆ˜ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@900&display=swap');
        body { 
            font-family: 'Noto Sans SC', sans-serif; 
            background: #F0FDF4; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
            height: 100vh; /* é”å®šå±å¹•é«˜åº¦ */
            overflow: hidden;
        }
        
        /* åŠ¨æ€å¡ç‰‡å®¹å™¨ï¼šç¡®ä¿ä¸æ»šåŠ¨ */
        .game-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 1rem;
        }

        .board-grid {
            flex-grow: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            align-content: stretch;
            min-height: 0; /* å…³é”®ï¼šé˜²æ­¢ç½‘æ ¼æ’‘å¼€çˆ¶å®¹å™¨ */
        }

        .column {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            height: 100%;
        }

        .card-item {
            flex: 1; /* è‡ªåŠ¨å¹³åˆ†é«˜åº¦ */
            font-size: 1.8rem;
            font-weight: 900;
            transition: all 0.2s;
            border-bottom: 6px solid #CBD5E1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        /* æŒ‘æˆ˜æ¨¡å¼ï¼šæ–‡å­—é®ç½© */
        .mask-text {
            filter: blur(8px);
            opacity: 0.3;
            transition: all 0.3s;
        }
        .card-selected .mask-text {
            filter: blur(0);
            opacity: 1;
        }

        .card-selected {
            transform: scale(0.98);
            background-color: #3B82F6 !important;
            color: white !important;
            border-bottom: 2px solid #1D4ED8;
        }

        .shake { animation: shake 0.4s both; }
        @keyframes shake { 10%,90%{transform:translateX(-2px)} 20%,80%{transform:translateX(4px)} 30%,50%,70%{transform:translateX(-6px)} 40%,60%{transform:translateX(6px)} }

        .matched-hide { animation: matchOut 0.4s forwards; pointer-events: none; }
        @keyframes matchOut { 100% { transform: scale(0); opacity: 0; } }
    </style>
</head>
<body>

    <div id="homeUI" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center p-8 text-center">
        <div class="text-[80px] mb-4">ğŸ†ğŸ±</div>
        <h1 class="text-5xl font-black text-slate-800 mb-2">å–µå–µå•è¯ç‹</h1>
        <p class="text-green-600 font-bold mb-8">V7.0 å…¨å±æ²‰æµ¸ç‰ˆ | æŒ‘æˆ˜å‡†ç¡®ç‡</p>
        <button id="startBtn" class="w-full max-w-sm bg-blue-600 text-white text-3xl font-black py-8 rounded-[3rem] shadow-xl">è¿›å…¥æŒ‘æˆ˜ ğŸš€</button>
    </div>

    <div class="game-container">
        <header class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-2">
                <button onclick="location.reload()" class="w-12 h-12 bg-white rounded-full shadow flex items-center justify-center text-xl">ğŸ </button>
                <div id="lifeDisplay" class="text-xl">â¤ï¸â¤ï¸â¤ï¸</div>
            </div>
            <div class="text-center">
                <div id="levelTitle" class="text-lg font-black text-slate-500 uppercase tracking-tighter">LEVEL 1</div>
                <div id="score" class="text-3xl font-black text-blue-600">0</div>
            </div>
            <div id="comboBadge" class="bg-orange-500 text-white px-3 py-1 rounded-lg font-black scale-0 transition-transform">X2</div>
        </header>

        <div class="w-full h-3 bg-slate-200 rounded-full mb-4">
            <div id="progressBar" class="h-full bg-green-500 transition-all duration-300" style="width: 0%"></div>
        </div>

        <div class="board-grid">
            <div id="leftCol" class="column"></div>
            <div id="rightCol" class="column"></div>
        </div>
    </div>

    <div id="winModal" class="hidden fixed inset-0 z-[110] bg-slate-900/90 backdrop-blur-sm flex items-center justify-center p-6 text-center">
        <div class="bg-white w-full max-w-md rounded-[3rem] p-10">
            <div id="resStar" class="text-6xl mb-4">â­â­â­</div>
            <h2 class="text-3xl font-black mb-2">é—¯å…³æˆåŠŸ!</h2>
            <div id="resStats" class="text-slate-500 font-bold mb-8"></div>
            <button id="nextBtn" class="w-full bg-blue-600 text-white font-black py-6 rounded-2xl text-2xl">ä¸‹ä¸€å…³ ğŸ¾</button>
        </div>
    </div>

    <script>
        let audioCtx, score=0, curLv=0, matched=0, combo=0, lives=3, selL=null, selR=null, totalClicks=0;

        const LIB = [
            { title: "ğŸ æ°´æœ", words: [{id:1,en:'Apple',cn:'è‹¹æœ',icon:'ğŸ'},{id:2,en:'Banana',cn:'é¦™è•‰',icon:'ğŸŒ'},{id:3,en:'Grape',cn:'è‘¡è„',icon:'ğŸ‡'},{id:4,en:'Peach',cn:'æ¡ƒå­',icon:'ğŸ‘'}] },
            { title: "ğŸ¯ åŠ¨ç‰©", words: [{id:5,en:'Lion',cn:'ç‹®å­',icon:'ğŸ¦'},{id:6,en:'Panda',cn:'ç†ŠçŒ«',icon:'ğŸ¼'},{id:7,en:'Rabbit',cn:'å…”å­',icon:'ğŸ°'},{id:8,en:'Tiger',cn:'è€è™',icon:'ğŸ¯'}] },
            { title: "ğŸ¥ª é£Ÿç‰©", words: [{id:9,en:'Bread',cn:'é¢åŒ…',icon:'ğŸ'},{id:10,en:'Milk',cn:'ç‰›å¥¶',icon:'ğŸ¥›'},{id:11,en:'Egg',cn:'é¸¡è›‹',icon:'ğŸ¥š'},{id:12,en:'Cake',cn:'è›‹ç³•',icon:'ğŸ°'}] }
        ];

        function speak(t) { new Audio(`https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(t)}&type=2`).play(); }
        
        function playSfx(f) {
            if(!audioCtx) return;
            const o=audioCtx.createOscillator(), g=audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            o.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime+0.2);
            o.start(); o.stop(audioCtx.currentTime+0.2);
        }

        document.getElementById('startBtn').onclick = () => {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            initGame(0);
        };

        function initGame(idx) {
            curLv=idx; matched=0; combo=0; lives=3; selL=null; selR=null; totalClicks=0;
            document.getElementById('homeUI').classList.add('hidden');
            document.getElementById('winModal').classList.add('hidden');
            document.getElementById('levelTitle').innerText = LIB[curLv].title;
            updateUI();
            render();
        }

        function updateUI() {
            document.getElementById('score').innerText = score;
            document.getElementById('lifeDisplay').innerText = "â¤ï¸".repeat(lives);
            document.getElementById('progressBar').style.width = (matched/LIB[curLv].words.length*100)+'%';
        }

        function render() {
            const l=document.getElementById('leftCol'), r=document.getElementById('rightCol');
            l.innerHTML = ''; r.innerHTML = '';
            const w = LIB[curLv].words;
            [...w].sort(()=>Math.random()-0.5).forEach(item => l.appendChild(createCard(item.en, 'L', item.id, item.en, false)));
            [...w].sort(()=>Math.random()-0.5).forEach(item => r.appendChild(createCard(item.icon, 'R', item.id, item.en, true)));
        }

        function createCard(txt, side, id, eng, isMasked) {
            const div = document.createElement('div');
            div.className = "card-item";
            // å¦‚æœæ˜¯å³ä¾§ä¸­æ–‡/å›¾æ ‡åˆ—ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©æ˜¯å¦é®ç½©æ–‡å­—
            div.innerHTML = isMasked ? `<span class="mask-text">${txt}</span>` : txt;
            div.onclick = () => {
                if(div.classList.contains('matched-hide')) return;
                totalClicks++;
                speak(eng);
                if(side==='L'){ if(selL) selL.classList.remove('card-selected'); selL=div; }
                else { if(selR) selR.classList.remove('card-selected'); selR=div; }
                div.classList.add('card-selected');

                if(selL && selR) {
                    if(selL.dataset.id === selR.dataset.id) {
                        combo++;
                        score += (100 * combo);
                        matched++;
                        playSfx(880);
                        confetti({particleCount:40, spread:50, origin:{y:0.9}});
                        const a=selL, b=selR;
                        setTimeout(()=>{ a.classList.add('matched-hide'); b.classList.add('matched-hide'); }, 200);
                        selL=null; selR=null;
                        if(matched === LIB[curLv].words.length) setTimeout(showWin, 600);
                    } else {
                        combo = 0;
                        lives--;
                        score = Math.max(0, score-20);
                        const a=selL, b=selR;
                        a.classList.add('shake'); b.classList.add('shake');
                        playSfx(220);
                        setTimeout(()=>{ 
                            a.classList.remove('card-selected','shake'); 
                            b.classList.remove('card-selected','shake'); 
                        }, 400);
                        selL=null; selR=null;
                        if(lives<=0) { alert("ç”Ÿå‘½ç”¨å®Œå•¦ï¼Œå†è¯•ä¸€æ¬¡ï¼"); initGame(curLv); }
                    }
                    updateUI();
                    document.getElementById('comboBadge').style.transform = combo > 1 ? 'scale(1.2)' : 'scale(0)';
                }
            };
            div.dataset.id = id;
            return div;
        }

        function showWin() {
            const modal = document.getElementById('winModal');
            modal.classList.remove('hidden');
            const acc = Math.round((LIB[curLv].words.length*2 / totalClicks) * 100);
            document.getElementById('resStats').innerHTML = `å‡†ç¡®ç‡: ${acc}%<br>å½“å‰æ€»åˆ†: ${score}`;
            document.getElementById('resStar').innerText = acc > 80 ? "â­â­â­" : (acc > 60 ? "â­â­" : "â­");
            document.getElementById('nextBtn').onclick = () => {
                if(curLv < LIB.length-1) initGame(curLv+1);
                else { alert("å…¨å…³å¡è¾¾æˆï¼ä½ æ˜¯è¶…çº§å•è¯ç‹ï¼"); location.reload(); }
            };
        }
    </script>
</body>
</html>
