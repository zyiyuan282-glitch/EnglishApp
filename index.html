
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–µå–µå•è¯ç‹ V11.0 - ç‹‚é£™è¿›åŒ–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@700;900&display=swap');
        
        :root { --bg-grad: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        body { font-family: 'Noto Sans SC', sans-serif; background: var(--bg-grad); height: 100vh; overflow: hidden; transition: background 1s ease; }
        
        .app-container { height: 100vh; display: flex; flex-direction: column; padding: 1.5rem; position: relative; z-index: 1; }

        /* å¡ç‰‡é«˜çº§è´¨æ„Ÿ */
        .card {
            flex: 1; margin: 0.6rem; background: rgba(255, 255, 255, 0.9); border-radius: 1.8rem;
            border: 4px solid white; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; flex-direction: column; items-center justify-center; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.05); cursor: pointer; position: relative;
            font-size: 2rem; font-weight: 900; color: #2d3748;
        }

        /* é€‰ä¸­ç‰¹æ•ˆï¼šå‘å…‰ */
        .card-active { transform: scale(1.02) translateY(-5px); border-color: #3b82f6; box-shadow: 0 0 25px rgba(59,130,246,0.4); background: white; z-index: 10; }

        /* æ¶ˆé™¤ç‰¹æ•ˆï¼šçˆ†å‘ç¼©å° */
        .card-matched { transform: scale(0) rotate(15deg); opacity: 0; pointer-events: none; }

        /* é”™è¯¯åé¦ˆ */
        .shake { animation: shake 0.4s both; border-color: #ff8787 !important; background: #fff5f5 !important; }
        @keyframes shake { 0%,100%{transform:rotate(0)} 20%{transform:rotate(-3deg)} 40%{transform:rotate(3deg)} 60%{transform:rotate(-3deg)} 80%{transform:rotate(3deg)} }

        /* æˆç»©å•åŠ¨ç”» */
        .pop-in { animation: popIn 0.5s cubic-bezier(0.26, 1.36, 0.74, 1) forwards; }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        .star-gold { color: #fcc419; text-shadow: 0 0 10px rgba(252,196,25,0.5); }
    </style>
</head>
<body>

    <div id="homeUI" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center p-8 text-center">
        <div class="text-[120px] mb-6 drop-shadow-xl">ğŸ±</div>
        <h1 class="text-7xl font-black text-slate-800 mb-6 tracking-tight">å–µå–µå•è¯ç‹ <span class="text-blue-600 text-3xl">V11</span></h1>
        <button id="startBtn" class="bg-blue-600 text-white px-24 py-8 rounded-[3rem] text-4xl font-black shadow-2xl active:scale-90 transition-all hover:bg-blue-700">
            GO! ğŸš€
        </button>
    </div>

    <div class="app-container">
        <header class="flex justify-between items-center mb-6">
            <button onclick="location.reload()" class="w-16 h-16 bg-white/80 backdrop-blur rounded-2xl shadow-sm flex items-center justify-center text-3xl">ğŸ </button>
            <div class="bg-white/80 backdrop-blur px-8 py-3 rounded-2xl shadow-sm">
                <span id="lvName" class="text-2xl font-black text-slate-700 tracking-widest">---</span>
            </div>
            <div class="text-4xl font-black text-blue-600 bg-white/80 px-6 py-3 rounded-2xl shadow-sm" id="score">0</div>
        </header>

        <div class="w-full h-4 bg-white/30 rounded-full mb-8 overflow-hidden backdrop-blur">
            <div id="progress" class="h-full bg-gradient-to-r from-blue-400 to-green-400 transition-all duration-500" style="width: 0%"></div>
        </div>

        <main class="flex-1 flex gap-6 min-h-0">
            <div id="leftCol" class="flex-1 flex flex-col"></div>
            <div id="rightCol" class="flex-1 flex flex-col"></div>
        </main>
    </div>

    <div id="reportModal" class="hidden fixed inset-0 z-[110] bg-slate-900/90 backdrop-blur-xl flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-xl rounded-[4rem] p-10 shadow-2xl pop-in text-center">
            <div id="starContainer" class="text-7xl mb-4 flex justify-center gap-2"></div>
            <h2 class="text-4xl font-black text-slate-800 mb-6">å…³å¡å­¦ä¹ æŠ¥å‘Š</h2>
            
            <div id="reportList" class="max-h-[40vh] overflow-y-auto mb-10 space-y-3 px-4 text-left"></div>

            <button id="nextBtn" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-8 rounded-3xl text-3xl font-black active:scale-95 shadow-xl transition-all">
                å¼€å¯ä¸‹ä¸€å…³ ğŸ¾
            </button>
        </div>
    </div>

    <script>
        let audioCtx, curLv=0, score=0, matched=0, selL=null, selR=null, errorCount=0;
        let attemptData = [];

        const LIB = [
            { name: "ğŸ æ°´æœå¤©åœ°", bg: "linear-gradient(135deg, #fff5f5 0%, #ffe3e3 100%)", words: [{id:1,en:'Apple',cn:'è‹¹æœ',icon:'ğŸ'},{id:2,en:'Banana',cn:'é¦™è•‰',icon:'ğŸŒ'},{id:3,en:'Grape',cn:'è‘¡è„',icon:'ğŸ‡'},{id:4,en:'Peach',cn:'æ¡ƒå­',icon:'ğŸ‘'}] },
            { name: "ğŸ¦ åŠ¨ç‰©ç‹å›½", bg: "linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%)", words: [{id:5,en:'Lion',cn:'ç‹®å­',icon:'ğŸ¦'},{id:6,en:'Panda',cn:'ç†ŠçŒ«',icon:'ğŸ¼'},{id:7,en:'Rabbit',cn:'å…”å­',icon:'ğŸ°'},{id:8,en:'Tiger',cn:'è€è™',icon:'ğŸ¯'}] },
            { name: "ğŸ ç¾å‘³æ—©é¤", bg: "linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%)", words: [{id:9,en:'Bread',cn:'é¢åŒ…',icon:'ğŸ'},{id:10,en:'Milk',cn:'ç‰›å¥¶',icon:'ğŸ¥›'},{id:11,en:'Egg',cn:'é¸¡è›‹',icon:'ğŸ¥š'},{id:12,en:'Cake',cn:'è›‹ç³•',icon:'ğŸ°'}] }
        ];

        // é«˜çº§åˆæˆå™¨éŸ³æ•ˆ
        function playSfx(isCorrect) {
            if(!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            
            const now = audioCtx.currentTime;
            if(isCorrect) {
                // ä¸Šè¡Œåä¸½æ¶ˆé™¤éŸ³
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.exponentialRampToValueAtTime(880, now + 0.1);
                osc.frequency.exponentialRampToValueAtTime(1760, now + 0.3);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.2, now + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                osc.start(now); osc.stop(now + 0.4);
            } else {
                // æ²‰é—·é”™è¯¯éŸ³
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(50, now + 0.2);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            }
        }

        function speak(t) { 
            const msg = new Audio(`https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(t)}&type=2`);
            msg.play();
        }

        document.getElementById('startBtn').onclick = () => {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            initLevel(0);
        };

        function initLevel(idx) {
            curLv = idx; matched = 0; selL = null; selR = null; errorCount = 0; attemptData = [];
            document.body.style.background = LIB[curLv].bg;
            document.getElementById('homeUI').classList.add('hidden');
            document.getElementById('reportModal').classList.add('hidden');
            document.getElementById('lvName').innerText = LIB[curLv].name;
            updateUI();
            renderCards();
        }

        function updateUI() {
            document.getElementById('score').innerText = score;
            document.getElementById('progress').style.width = (matched / LIB[curLv].words.length * 100) + '%';
        }

        function renderCards() {
            const lCol = document.getElementById('leftCol'), rCol = document.getElementById('rightCol');
            lCol.innerHTML = ''; rCol.innerHTML = '';
            const words = LIB[curLv].words;
            [...words].sort(()=>Math.random()-0.5).forEach(w => lCol.appendChild(createCard(w.en, 'L', w.id, w.en)));
            [...words].sort(()=>Math.random()-0.5).forEach(w => rCol.appendChild(createCard(w.icon + ' ' + w.cn, 'R', w.id, w.en)));
        }

        function createCard(txt, side, id, eng) {
            const card = document.createElement('div');
            card.className = "card";
            card.innerText = txt;
            card.onclick = (e) => {
                if(card.classList.contains('card-matched')) return;
                speak(eng);
                
                if(side === 'L') { if(selL) selL.classList.remove('card-active'); selL = card; }
                else { if(selR) selR.classList.remove('card-active'); selR = card; }
                card.classList.add('card-active');

                if(selL && selR) {
                    const isMatch = selL.dataset.id === selR.dataset.id;
                    const idL = selL.dataset.id;
                    
                    if(isMatch) {
                        score += 150; matched++;
                        playSfx(true);
                        // çˆ†å‘ç²’å­ç‰¹æ•ˆ
                        confetti({ particleCount: 50, spread: 80, origin: { x: e.clientX/window.innerWidth, y: e.clientY/window.innerHeight } });
                        const a = selL, b = selR;
                        setTimeout(() => { a.classList.add('card-matched'); b.classList.add('card-matched'); }, 100);
                        attemptData.push({ id, status: 'âœ…' });
                        selL = null; selR = null;
                        if(matched === LIB[curLv].words.length) setTimeout(showFinalReport, 800);
                    } else {
                        errorCount++;
                        playSfx(false);
                        const a = selL, b = selR;
                        a.classList.add('shake'); b.classList.add('shake');
                        setTimeout(() => {
                            a.classList.remove('card-active', 'shake');
                            b.classList.remove('card-active', 'shake');
                        }, 400);
                        selL = null; selR = null;
                    }
                    updateUI();
                }
            };
            card.dataset.id = id;
            return card;
        }

        function showFinalReport() {
            const modal = document.getElementById('reportModal');
            const list = document.getElementById('reportList');
            const starBox = document.getElementById('starContainer');
            list.innerHTML = '';
            starBox.innerHTML = '';
            
            // æ˜Ÿæ˜Ÿé€»è¾‘
            let stars = 3;
            if(errorCount > 1) stars = 2;
            if(errorCount > 3) stars = 1;
            for(let i=0; i<3; i++) starBox.innerHTML += `<span class="${i<stars?'star-gold':'opacity-20'}">â­</span>`;

            // æŠ¥å‘Šåˆ—è¡¨å†…å®¹ä»æœ¬å…³LIBä¸­æå–
            LIB[curLv].words.forEach(w => {
                const item = document.createElement('div');
                item.className = "flex justify-between items-center bg-slate-50 p-4 rounded-2xl border-l-8 border-blue-400";
                item.innerHTML = `<div><p class="font-black text-slate-700 text-xl">${w.en}</p><p class="text-slate-400 font-bold">${w.cn}</p></div><div class="text-2xl">âœ…</div>`;
                list.appendChild(item);
            });

            modal.classList.remove('hidden');
            document.getElementById('nextBtn').onclick = () => {
                if(curLv < LIB.length - 1) initLevel(curLv + 1);
                else { alert("ğŸ‰ å…¨èƒ½å•è¯ç‹è¯ç”Ÿï¼"); location.reload(); }
            };
        }
    </script>
</body>
</html>
