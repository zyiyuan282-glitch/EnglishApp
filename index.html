
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–µå–µå•è¯ç‹ V5.0 - è¶£å‘³å…¨èƒ½ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@900&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background: #fdf6e3; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        .card-item {
            font-size: 2.2rem;
            font-weight: 900;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-bottom: 8px solid #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 120px;
            background: white;
            border-radius: 2.2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .card-selected {
            transform: translateY(-8px);
            background-color: #3b82f6 !important;
            color: white !important;
            border-bottom-color: #1d4ed8;
        }

        .matched-hide { animation: matchOut 0.5s forwards; pointer-events: none; }
        @keyframes matchOut { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }
        
        .floating { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* æ˜Ÿæ˜ŸåŠ¨ç”» */
        .star-pop { animation: starPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes starPop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="homeUI" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center p-8 text-center">
        <div class="text-[120px] mb-8 floating">ğŸ‘¨â€ğŸ“ğŸ±</div>
        <h1 class="text-6xl font-black text-slate-800 mb-4">å–µå–µå•è¯ç‹</h1>
        <p class="text-blue-500 font-bold mb-16 text-2xl">æŒ‘æˆ˜äº”å¤§å…³å¡ï¼Œèµ¢å–é‡‘é‡‘æ˜Ÿï¼</p>
        <button id="startBtn" class="w-full max-w-lg bg-orange-500 text-white text-4xl font-black py-10 rounded-[4rem] shadow-2xl active:scale-95 transition-all">
            å¼€å§‹æŒ‘æˆ˜ ğŸš€
        </button>
    </div>

    <header class="p-6 flex justify-between items-center bg-white/80 backdrop-blur sticky top-0 z-10">
        <div class="flex items-center gap-4">
            <button onclick="location.reload()" class="w-14 h-14 bg-slate-100 rounded-full flex items-center justify-center text-3xl">ğŸ </button>
            <div id="levelTitle" class="text-3xl font-black text-slate-700">æ­£åœ¨è¿›å…¥...</div>
        </div>
        <div class="flex flex-col items-end">
            <span id="score" class="text-4xl font-black text-orange-500">0</span>
            <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Score</span>
        </div>
    </header>

    <main class="flex-grow p-6 max-w-6xl mx-auto w-full">
        <div class="w-full h-6 bg-slate-200 rounded-full mb-10 overflow-hidden shadow-inner">
            <div id="progressBar" class="h-full bg-blue-500 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
        <div class="grid grid-cols-2 gap-8" id="board">
            <div id="leftCol" class="space-y-6"></div>
            <div id="rightCol" class="space-y-6"></div>
        </div>
    </main>

    <div id="winModal" class="hidden fixed inset-0 z-[110] bg-slate-900/80 backdrop-blur-md flex items-center justify-center p-6 text-center">
        <div class="bg-white w-full max-w-xl rounded-[4rem] p-12 shadow-2xl">
            <div id="starContainer" class="text-7xl mb-6 flex justify-center gap-2"></div>
            <h2 class="text-4xl font-black text-slate-800 mb-2">å¤ªæ£’äº†ï¼</h2>
            <p id="winMsg" class="text-slate-500 text-xl mb-12 italic"></p>
            <button id="nextBtn" class="w-full bg-blue-600 text-white font-black py-8 rounded-3xl text-3xl shadow-lg active:scale-95">æŒ‘æˆ˜ä¸‹ä¸€å…³ ğŸ¾</button>
        </div>
    </div>

    <script>
        let audioCtx = null, curLv = 0, score = 0, matched = 0, selL = null, selR = null, errors = 0;

        const LIB = [
            { title: "ğŸ æ°´æœæ´¾å¯¹", words: [{ id:1, en:'Apple', cn:'è‹¹æœ', icon:'ğŸ'}, { id:2, en:'Banana', cn:'é¦™è•‰', icon:'ğŸŒ'}, { id:3, en:'Grape', cn:'è‘¡è„', icon:'ğŸ‡'}, { id:4, en:'Peach', cn:'æ¡ƒå­', icon:'ğŸ‘'}] },
            { title: "ğŸ¦ åŠ¨ç‰©ä¹å›­", words: [{ id:5, en:'Lion', cn:'ç‹®å­', icon:'ğŸ¦'}, { id:6, en:'Panda', cn:'ç†ŠçŒ«', icon:'ğŸ¼'}, { id:7, en:'Rabbit', cn:'å…”å­', icon:'ğŸ°'}, { id:8, en:'Tiger', cn:'è€è™', icon:'ğŸ¯'}] },
            { title: "ğŸ” ç¾å‘³é£Ÿç‰©", words: [{ id:9, en:'Bread', cn:'é¢åŒ…', icon:'ğŸ'}, { id:10, en:'Milk', cn:'ç‰›å¥¶', icon:'ğŸ¥›'}, { id:11, en:'Egg', cn:'é¸¡è›‹', icon:'ğŸ¥š'}, { id:12, en:'Cake', cn:'è›‹ç³•', icon:'ğŸ°'}] },
            { title: "ğŸŒˆ ç¼¤çº·é¢œè‰²", words: [{ id:13, en:'Red', cn:'çº¢è‰²', icon:'ğŸ”´'}, { id:14, en:'Blue', cn:'è“è‰²', icon:'ğŸ”µ'}, { id:15, en:'Green', cn:'ç»¿è‰²', icon:'ğŸŸ¢'}, { id:16, en:'Yellow', cn:'é»„è‰²', icon:'ğŸŸ¡'}] },
            { title: "ğŸ”¢ è¶£å‘³æ•°å­—", words: [{ id:17, en:'One', cn:'ä¸€', icon:'1ï¸âƒ£'}, { id:18, en:'Two', cn:'äºŒ', icon:'2ï¸âƒ£'}, { id:19, en:'Three', cn:'ä¸‰', icon:'3ï¸âƒ£'}, { id:20, en:'Four', cn:'å››', icon:'4ï¸âƒ£'}] }
        ];

        function initAudio() { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

        function speak(text) {
            const audio = new Audio(`https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(text)}&type=2`);
            audio.play();
        }

        function playDing() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(1000, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        }

        document.getElementById('startBtn').onclick = () => { initAudio(); initGame(0); };

        function initGame(idx) {
            curLv = idx; matched = 0; errors = 0; selL = null; selR = null;
            document.getElementById('homeUI').classList.add('hidden');
            document.getElementById('winModal').classList.add('hidden');
            document.getElementById('levelTitle').innerText = LIB[curLv].title;
            document.getElementById('progressBar').style.width = '0%';
            render();
        }

        function render() {
            const lCol = document.getElementById('leftCol'), rCol = document.getElementById('rightCol');
            lCol.innerHTML = ''; rCol.innerHTML = '';
            const words = LIB[curLv].words;
            const dL = [...words].sort(() => Math.random() - 0.5);
            const dR = [...words].sort(() => Math.random() - 0.5);
            dL.forEach(i => lCol.appendChild(createBtn(i.en, 'L', i.id, i.en)));
            dR.forEach(i => rCol.appendChild(createBtn(i.icon + ' ' + i.cn, 'R', i.id, i.en)));
        }

        function createBtn(txt, side, id, english) {
            const b = document.createElement('button');
            b.className = "card-item w-full";
            b.innerText = txt;
            b.onclick = () => {
                speak(english);
                if (side === 'L') { if(selL) selL.classList.remove('card-selected'); selL = b; }
                else { if(selR) selR.classList.remove('card-selected'); selR = b; }
                b.classList.add('card-selected');
                
                if (selL && selR) {
                    if (selL.dataset.id === selR.dataset.id) {
                        score += 100; matched++;
                        document.getElementById('score').innerText = score;
                        document.getElementById('progressBar').style.width = (matched / LIB[curLv].words.length * 100) + '%';
                        playDing();
                        confetti({ particleCount: 60, spread: 70, origin: { y: 0.8 } });
                        selL.classList.add('matched-hide'); selR.classList.add('matched-hide');
                        selL = null; selR = null;
                        if (matched === LIB[curLv].words.length) setTimeout(showVictory, 800);
                    } else {
                        errors++;
                        const l = selL, r = selR;
                        setTimeout(() => { l.classList.remove('card-selected'); r.classList.remove('card-selected'); }, 400);
                        selL = null; selR = null;
                    }
                }
            };
            b.dataset.id = id;
            return b;
        }

        function showVictory() {
            const winModal = document.getElementById('winModal');
            const starContainer = document.getElementById('starContainer');
            const winMsg = document.getElementById('winMsg');
            winModal.classList.remove('hidden');
            
            // æ˜Ÿæ˜Ÿè¯„åˆ†é€»è¾‘
            let starCount = 3;
            if (errors > 2) starCount = 2;
            if (errors > 5) starCount = 1;
            
            starContainer.innerHTML = '';
            for(let i=0; i<3; i++) {
                const star = document.createElement('span');
                star.innerText = i < starCount ? 'â­' : 'â˜†';
                star.className = i < starCount ? 'star-pop' : 'opacity-30';
                starContainer.appendChild(star);
            }

            const msgs = ["ç®€ç›´æ˜¯å¤©æ‰ï¼", "åšå¾—å¾ˆæ£’ï¼Œç»§ç»­åŠ æ²¹ï¼", "å­¦ä¼šäº†ä¸å°‘æ–°å•è¯å“¦ï¼"];
            winMsg.innerText = msgs[3 - starCount];

            document.getElementById('nextBtn').onclick = () => {
                if (curLv < LIB.length - 1) initGame(curLv + 1);
                else { alert("ğŸ‰ æ­å–œé€šå…³æ‰€æœ‰å…³å¡ï¼ä½ æ˜¯æœ€æ£’çš„å•è¯ç‹ï¼"); location.reload(); }
            };
        }
    </script>
</body>
</html>
