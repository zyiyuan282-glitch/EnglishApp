
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–µå–µå•è¯ç‹ V10.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@700;900&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background: #F8FAFC; height: 100vh; overflow: hidden; }
        
        /* æ¸¸æˆä¸»åŒºåŸŸï¼šé”å®šä¸€å±é«˜åº¦ */
        .app-container { height: 100vh; display: flex; flex-direction: column; padding: 1rem; }
        
        /* å¡ç‰‡åŸºç¡€æ ·å¼ */
        .card {
            flex: 1; margin: 0.5rem; background: white; border-radius: 1.5rem;
            border: 3px solid #E2E8F0; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 6px 0 #E2E8F0; cursor: pointer; position: relative;
            font-size: 1.8rem; font-weight: 900; color: #334155;
        }

        /* é€‰ä¸­æ€ */
        .card-active { border-color: #3B82F6; background-color: #EFF6FF; transform: translateY(2px); box-shadow: 0 2px 0 #3B82F6; }

        /* æ¶ˆé™¤åŠ¨ç”»ï¼šç¼©å°å¹¶å˜é€æ˜ */
        .card-matched { transform: scale(0); opacity: 0; pointer-events: none; }

        /* é”™è¯¯æŠ–åŠ¨ */
        .shake { animation: shake 0.4s both; border-color: #FCA5A5 !important; background-color: #FEF2F2 !important; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 20%,60%{transform:translateX(-6px)} 40%,80%{transform:translateX(6px)} }

        /* æˆç»©å•åˆ—è¡¨æ ·å¼ */
        .report-item { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; border-bottom: 1px solid #F1F5F9; }
    </style>
</head>
<body>

    <div id="homeUI" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center p-8 text-center">
        <div class="text-[100px] mb-4">ğŸ±â€ğŸ“</div>
        <h1 class="text-6xl font-black text-slate-800 mb-4">å–µå–µå•è¯ç‹</h1>
        <p class="text-slate-400 text-xl font-bold mb-10">V10.0 å…¨æ–°éŸ³æ•ˆä¸å¤ä¹ æŠ¥å‘Šç‰ˆ</p>
        <button id="startBtn" class="bg-blue-600 text-white px-20 py-6 rounded-3xl text-4xl font-black shadow-2xl active:scale-90 transition-all">
            å¼€å§‹å­¦ä¹ 
        </button>
    </div>

    <div class="app-container">
        <header class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-4">
                <button onclick="location.reload()" class="w-12 h-12 bg-white rounded-2xl shadow-sm flex items-center justify-center text-2xl">ğŸ </button>
                <div class="bg-white px-4 py-2 rounded-2xl shadow-sm font-black text-blue-600" id="lvName">åŠ è½½ä¸­...</div>
            </div>
            <div id="score" class="text-4xl font-black text-orange-500">0</div>
        </header>

        <div class="w-full h-3 bg-slate-200 rounded-full mb-6">
            <div id="progress" class="h-full bg-green-500 transition-all duration-300" style="width: 0%"></div>
        </div>

        <main class="flex-1 flex gap-4 min-h-0">
            <div id="leftCol" class="flex-1 flex flex-col"></div>
            <div id="rightCol" class="flex-1 flex flex-col"></div>
        </main>
    </div>

    <div id="reportModal" class="hidden fixed inset-0 z-[110] bg-slate-900/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-[3rem] p-8 shadow-2xl flex flex-col max-h-[90vh]">
            <div class="text-center mb-6">
                <div id="reportEmoji" class="text-7xl mb-2">ğŸˆ</div>
                <h2 class="text-3xl font-black text-slate-800">å­¦ä¹ æŠ¥å‘Š</h2>
                <p class="text-slate-400 font-bold">çœ‹çœ‹æœ¬å…³çš„æŒæ¡æƒ…å†µå§</p>
            </div>

            <div id="reportList" class="flex-1 overflow-y-auto mb-8 bg-slate-50 rounded-3xl p-4">
                </div>

            <button id="nextBtn" class="w-full bg-blue-600 text-white py-6 rounded-2xl text-2xl font-black active:scale-95 shadow-lg">
                æŒ‘æˆ˜ä¸‹ä¸€å…³ ğŸš€
            </button>
        </div>
    </div>

    <script>
        let audioCtx, curLv=0, score=0, matched=0, selL=null, selR=null;
        let attemptLog = {}; // è®°å½•æ¯ä¸ªå•è¯çš„å°è¯•æƒ…å†µ

        const LIB = [
            { name: "ğŸ æ°´æœå¤©åœ°", words: [{id:1,en:'Apple',cn:'è‹¹æœ',icon:'ğŸ'},{id:2,en:'Banana',cn:'é¦™è•‰',icon:'ğŸŒ'},{id:3,en:'Grape',cn:'è‘¡è„',icon:'ğŸ‡'},{id:4,en:'Peach',cn:'æ¡ƒå­',icon:'ğŸ‘'}] },
            { name: "ğŸ¦ åŠ¨ç‰©ç‹å›½", words: [{id:5,en:'Lion',cn:'ç‹®å­',icon:'ğŸ¦'},{id:6,en:'Panda',cn:'ç†ŠçŒ«',icon:'ğŸ¼'},{id:7,en:'Rabbit',cn:'å…”å­',icon:'ğŸ°'},{id:8,en:'Tiger',cn:'è€è™',icon:'ğŸ¯'}] },
            { name: "ğŸ¥› ç¾å‘³æ—©é¤", words: [{id:9,en:'Bread',cn:'é¢åŒ…',icon:'ğŸ'},{id:10,en:'Milk',cn:'ç‰›å¥¶',icon:'ğŸ¥›'},{id:11,en:'Egg',cn:'é¸¡è›‹',icon:'ğŸ¥š'},{id:12,en:'Cake',cn:'è›‹ç³•',icon:'ğŸ°'}] }
        ];

        // é«˜çº§éŸ³æ•ˆç³»ç»Ÿ
        function playSfx(type) {
            if(!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            
            if(type === 'correct') {
                osc.frequency.setValueAtTime(880, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1320, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(220, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(110, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            }
            osc.start(); osc.stop(audioCtx.currentTime + 0.2);
        }

        function speak(t) { new Audio(`https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(t)}&type=2`).play(); }

        document.getElementById('startBtn').onclick = () => {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            initGame(0);
        };

        function initGame(idx) {
            curLv = idx; matched = 0; selL = null; selR = null; attemptLog = {};
            LIB[curLv].words.forEach(w => attemptLog[w.id] = { en: w.en, cn: w.cn, error: false });
            
            document.getElementById('homeUI').classList.add('hidden');
            document.getElementById('reportModal').classList.add('hidden');
            document.getElementById('lvName').innerText = LIB[curLv].name;
            updateUI();
            render();
        }

        function updateUI() {
            document.getElementById('score').innerText = score;
            document.getElementById('progress').style.width = (matched / LIB[curLv].words.length * 100) + '%';
        }

        function render() {
            const lCol = document.getElementById('leftCol'), rCol = document.getElementById('rightCol');
            lCol.innerHTML = ''; rCol.innerHTML = '';
            const words = LIB[curLv].words;
            [...words].sort(()=>Math.random()-0.5).forEach(w => lCol.appendChild(createCard(w.en, 'L', w.id, w.en)));
            [...words].sort(()=>Math.random()-0.5).forEach(w => rCol.appendChild(createCard(w.icon + ' ' + w.cn, 'R', w.id, w.en)));
        }

        function createCard(txt, side, id, eng) {
            const card = document.createElement('div');
            card.className = "card";
            card.innerText = txt;
            card.onclick = () => {
                if(card.classList.contains('card-matched')) return;
                speak(eng);
                
                if(side === 'L') { if(selL) selL.classList.remove('card-active'); selL = card; }
                else { if(selR) selR.classList.remove('card-active'); selR = card; }
                card.classList.add('card-active');

                if(selL && selR) {
                    if(selL.dataset.id === selR.dataset.id) {
                        // ç­”å¯¹äº†
                        score += 100; matched++;
                        playSfx('correct');
                        confetti({ particleCount: 40, spread: 60, origin: { y: 0.8 } });
                        const a = selL, b = selR;
                        setTimeout(() => { a.classList.add('card-matched'); b.classList.add('card-matched'); }, 150);
                        selL = null; selR = null;
                        if(matched === LIB[curLv].words.length) setTimeout(showReport, 800);
                    } else {
                        // ç­”é”™äº†
                        attemptLog[id].error = true; // è®°å½•é”™è¯¯
                        playSfx('error');
                        const a = selL, b = selR;
                        a.classList.add('shake'); b.classList.add('shake');
                        setTimeout(() => {
                            a.classList.remove('card-active', 'shake');
                            b.classList.remove('card-active', 'shake');
                        }, 400);
                        selL = null; selR = null;
                    }
                    updateUI();
                }
            };
            card.dataset.id = id;
            return card;
        }

        function showReport() {
            const modal = document.getElementById('reportModal');
            const list = document.getElementById('reportList');
            list.innerHTML = '';
            
            let totalErrors = 0;
            Object.values(attemptLog).forEach(item => {
                if(item.error) totalErrors++;
                const div = document.createElement('div');
                div.className = "report-item";
                div.innerHTML = `
                    <div class="text-left">
                        <p class="font-black text-slate-700">${item.en}</p>
                        <p class="text-xs text-slate-400">${item.cn}</p>
                    </div>
                    <div class="text-xl">${item.error ? 'âŒ' : 'âœ…'}</div>
                `;
                list.appendChild(div);
            });

            document.getElementById('reportEmoji').innerText = totalErrors === 0 ? "ğŸ‘‘" : "ğŸ‘";
            modal.classList.remove('hidden');

            document.getElementById('nextBtn').onclick = () => {
                if(curLv < LIB.length - 1) initGame(curLv + 1);
                else { alert("ç»ˆæå•è¯ç‹æŒ‘æˆ˜åœ†æ»¡æˆåŠŸï¼"); location.reload(); }
            };
        }
    </script>
</body>
</html>
