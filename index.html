
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–µå–µå•è¯ç‹ V9.0 - æ·±åº¦é›†æˆç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/canvas-confetti@1.6.0/dist/confetti.browser.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@500;900&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background: #f8fafc; height: 100vh; overflow: hidden; }
        
        /* å®¹å™¨é”å®š */
        .game-wrapper { height: 100vh; display: flex; flex-direction: column; padding: 1.5rem; }

        /* å¡ç‰‡ç²¾ç»†åŒ–è®¾è®¡ */
        .card {
            flex: 1; margin: 0.5rem; background: white; border-radius: 1.5rem;
            border: 2px solid #e2e8f0; transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 4px 0 #e2e8f0; cursor: pointer; position: relative;
        }

        /* é€‰ä¸­çŠ¶æ€ï¼šå‘ä¸‹æŒ‰å‹æ„Ÿ */
        .card-active { border-color: #3b82f6; background-color: #eff6ff; transform: translateY(2px); box-shadow: 0 2px 0 #3b82f6; }

        /* æˆåŠŸé”å®šï¼šæŸ”å’Œç»¿ */
        .card-matched { 
            background-color: #f0fdf4 !important; border-color: #86efac !important; 
            box-shadow: 0 0 0 transparent !important; transform: translateY(4px);
            color: #166534 !important; pointer-events: none;
        }

        /* é”™è¯¯åé¦ˆï¼šéœ‡åŠ¨çº¢ */
        .card-error { border-color: #fca5a5; background-color: #fef2f2; animation: shake 0.4s; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)} }

        /* é¡¶éƒ¨è£…é¥°æ  */
        .stat-badge { background: white; padding: 0.5rem 1rem; border-radius: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <div id="homeUI" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center text-center">
        <div class="text-9xl mb-8">ğŸ˜¸</div>
        <h1 class="text-6xl font-black text-slate-800 mb-2">å–µå–µå•è¯ç‹</h1>
        <p class="text-slate-400 text-2xl mb-12 font-medium">æ™ºèƒ½å¤ä¹ æ¨¡å¼å·²å¼€å¯</p>
        <button id="startBtn" class="bg-blue-600 text-white px-16 py-6 rounded-3xl text-4xl font-black shadow-2xl active:scale-95 transition-all">å¼€å§‹é—¯å…³</button>
    </div>

    <div class="game-wrapper">
        <header class="flex justify-between items-center mb-6">
            <div class="flex gap-3">
                <button onclick="location.reload()" class="stat-badge text-2xl">ğŸ </button>
                <div class="stat-badge flex items-center gap-2 font-bold text-slate-600">
                    <span id="levelName">åŠ è½½ä¸­...</span>
                </div>
            </div>
            <div class="flex gap-4">
                <div class="stat-badge text-right">
                    <div class="text-[10px] text-slate-400 font-black uppercase">Coins</div>
                    <div id="coins" class="text-2xl font-black text-yellow-500 leading-none">0</div>
                </div>
                <div class="stat-badge text-right">
                    <div class="text-[10px] text-slate-400 font-black uppercase">Score</div>
                    <div id="scoreDisplay" class="text-2xl font-black text-blue-600 leading-none">0</div>
                </div>
            </div>
        </header>

        <div class="w-full h-3 bg-slate-200 rounded-full mb-6">
            <div id="progress" class="h-full bg-blue-500 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>

        <main class="flex-1 flex gap-4 min-h-0">
            <div id="leftCol" class="flex-1 flex flex-col"></div>
            <div id="rightCol" class="flex-1 flex flex-col"></div>
        </main>
    </div>

    <div id="winModal" class="hidden fixed inset-0 z-[110] bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-md rounded-[3rem] p-10 text-center shadow-2xl scale-in">
            <div class="text-8xl mb-4">ğŸ–ï¸</div>
            <h2 class="text-4xl font-black text-slate-800 mb-2">å¤ªæ£’äº†!</h2>
            <p id="winMsg" class="text-slate-500 font-bold mb-8">ä½ å®Œæˆäº†ä¸€æ¬¡å®Œç¾çš„å­¦ä¹ </p>
            <div class="grid grid-cols-2 gap-4 mb-10">
                <div class="bg-blue-50 p-4 rounded-2xl">
                    <p class="text-xs text-blue-400 font-bold italic">å‡†ç¡®ç‡</p>
                    <p id="accuracy" class="text-2xl font-black text-blue-600">100%</p>
                </div>
                <div class="bg-yellow-50 p-4 rounded-2xl">
                    <p class="text-xs text-yellow-600 font-bold italic">è·å¾—é‡‘å¸</p>
                    <p id="earnedCoins" class="text-2xl font-black text-yellow-600">+0</p>
                </div>
            </div>
            <button id="nextBtn" class="w-full bg-slate-900 text-white py-6 rounded-2xl text-2xl font-black active:scale-95 transition-all">æŒ‘æˆ˜ä¸‹ä¸€å…³</button>
        </div>
    </div>

    <script>
        const LIB = [
            { name: "ğŸ æ°´æœç¯‡", words: [{id:1,en:'Apple',cn:'è‹¹æœ',icon:'ğŸ'},{id:2,en:'Banana',cn:'é¦™è•‰',icon:'ğŸŒ'},{id:3,en:'Grape',cn:'è‘¡è„',icon:'ğŸ‡'},{id:4,en:'Peach',cn:'æ¡ƒå­',icon:'ğŸ‘'}] },
            { name: "ğŸ± åŠ¨ç‰©ç¯‡", words: [{id:5,en:'Lion',cn:'ç‹®å­',icon:'ğŸ¦'},{id:6,en:'Panda',cn:'ç†ŠçŒ«',icon:'ğŸ¼'},{id:7,en:'Rabbit',cn:'å…”å­',icon:'ğŸ°'},{id:8,en:'Tiger',cn:'è€è™',icon:'ğŸ¯'}] },
            { name: "ğŸ¥ª é£Ÿç‰©ç¯‡", words: [{id:9,en:'Bread',cn:'é¢åŒ…',icon:'ğŸ'},{id:10,en:'Milk',cn:'ç‰›å¥¶',icon:'ğŸ¥›'},{id:11,en:'Egg',cn:'é¸¡è›‹',icon:'ğŸ¥š'},{id:12,en:'Cake',cn:'è›‹ç³•',icon:'ğŸ°'}] }
        ];

        let curLv = 0, score = 0, coins = parseInt(localStorage.getItem('catCoins')) || 0, 
            matchedCount = 0, selL = null, selR = null, totalClicks = 0, wrongIds = new Set();

        document.getElementById('coins').innerText = coins;

        function speak(t) {
            new Audio(`https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(t)}&type=2`).play();
        }

        document.getElementById('startBtn').onclick = () => { initGame(0); };

        function initGame(idx) {
            curLv = idx; matchedCount = 0; selL = null; selR = null; totalClicks = 0; wrongIds.clear();
            document.getElementById('homeUI').classList.add('hidden');
            document.getElementById('winModal').classList.add('hidden');
            document.getElementById('levelName').innerText = LIB[curLv].name;
            render();
            updateUI();
        }

        function updateUI() {
            document.getElementById('scoreDisplay').innerText = score;
            document.getElementById('progress').style.width = (matchedCount / LIB[curLv].words.length * 100) + '%';
        }

        function render() {
            const l = document.getElementById('leftCol'), r = document.getElementById('rightCol');
            l.innerHTML = ''; r.innerHTML = '';
            const w = LIB[curLv].words;
            [...w].sort(()=>Math.random()-0.5).forEach(item => l.appendChild(createCard(item.en, 'L', item.id, item.en)));
            [...w].sort(()=>Math.random()-0.5).forEach(item => r.appendChild(createCard(item.icon + ' ' + item.cn, 'R', item.id, item.en)));
        }

        function createCard(txt, side, id, eng) {
            const btn = document.createElement('div');
            btn.className = "card text-2xl font-bold text-slate-700";
            btn.innerText = txt;
            btn.onclick = () => {
                if(btn.classList.contains('card-matched')) return;
                totalClicks++;
                speak(eng);
                if(side === 'L') { if(selL) selL.classList.remove('card-active'); selL = btn; }
                else { if(selR) selR.classList.remove('card-active'); selR = btn; }
                btn.classList.add('card-active');

                if(selL && selR) {
                    if(selL.dataset.id === selR.dataset.id) {
                        selL.classList.replace('card-active', 'card-matched');
                        selR.classList.replace('card-active', 'card-matched');
                        score += 100; matchedCount++;
                        confetti({ particleCount: 40, spread: 60, origin: { y: 0.8 } });
                        selL = null; selR = null;
                        if(matchedCount === LIB[curLv].words.length) {
                            if(wrongIds.size > 0) setTimeout(reviewWrongWords, 1000); // è§¦å‘å¤ä¹ æ¨¡å¼
                            else setTimeout(showWin, 800);
                        }
                    } else {
                        wrongIds.add(id); // è®°å½•é”™é¢˜
                        const a = selL, b = selR;
                        a.classList.add('card-error'); b.classList.add('card-error');
                        setTimeout(() => {
                            a.classList.remove('card-active', 'card-error');
                            b.classList.remove('card-active', 'card-error');
                        }, 400);
                        selL = null; selR = null;
                    }
                    updateUI();
                }
            };
            btn.dataset.id = id;
            return btn;
        }

        // å¤ä¹ æ¨¡å¼ï¼šæŠŠé”™é¢˜é‡æ–°å˜ç™½ï¼Œå†ç»ƒä¸€é
        function reviewWrongWords() {
            alert("å–µï¼æœ‰å‡ ä¸ªå•è¯è®°é”™äº†ï¼Œæˆ‘ä»¬å†è¯•ä¸€æ¬¡è¿™äº›å§ï¼");
            const allCards = document.querySelectorAll('.card');
            matchedCount = 0;
            allCards.forEach(c => {
                if(wrongIds.has(parseInt(c.dataset.id))) {
                    c.className = "card text-2xl font-bold text-slate-700";
                } else {
                    c.classList.add('matched-hide'); // å¯¹çš„æš‚æ—¶éšè—
                }
            });
            wrongIds.clear();
            updateUI();
        }

        function showWin() {
            const acc = Math.round((LIB[curLv].words.length*2 / totalClicks) * 100);
            const earned = Math.floor(acc / 10);
            coins += earned;
            localStorage.setItem('catCoins', coins);
            
            document.getElementById('winModal').classList.remove('hidden');
            document.getElementById('accuracy').innerText = acc + "%";
            document.getElementById('earnedCoins').innerText = "+" + earned;
            document.getElementById('coins').innerText = coins;

            document.getElementById('nextBtn').onclick = () => {
                if(curLv < LIB.length - 1) initGame(curLv + 1);
                else { alert("ç»ˆææŒ‘æˆ˜è¾¾æˆï¼"); location.reload(); }
            };
        }
    </script>
</body>
</html>
